<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.free.badmood.blackhole.web.mapper.CommentMapper">


    <select id="queryUserComment" resultType="com.free.badmood.blackhole.web.entity.UserCommentVo">

        SELECT c.*,count(reply_id) as reply_count,u.avatar_url,u.nick_name
        from t_f_comment c
            LEFT JOIN
                t_f_reply r
            on (r.reply_id = c.id and r.reply_type = 0)
            LEFT JOIN
                t_f_user u
            on
                u.id = c.from_user_id
        where
            c.del = 0
            and c.article_id = #{articleId}
            and  c.article_type = "normal"
        GROUP BY IFNULL(reply_id,UUID())

        order by create_time desc


    </select>
</mapper>
